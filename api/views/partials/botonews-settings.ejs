<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/bootstrap-slider.min.js"
    integrity="sha512-f0VlzJbcEB6KiW8ZVtL+5HWPDyW1+nJEjguZ5IVnSQkvZbwBt2RfCBY0CBO1PsMAqxxrG4Di6TfsCPP3ZRwKpA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/css/bootstrap-slider.min.css"
    integrity="sha512-3q8fi8M0VS+X/3n64Ndpp6Bit7oXSiyCnzmlx6IDBLGlY5euFySyJ46RUlqIVs0DPCGOypqP8IRk/EyPvU28mQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pickerjs@1.2.1/src/css/picker.css">
<div class="col-xl-9 col-lg-9 col-md-12 col-sm-12 col-12">
    <div class="card h-100">
        <div class="card-body">
            <div class="row gutters">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                    <h6 class="mb-3 underline">Botonews settings</h6>
                </div>
                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">

                    <div class="modes">
                        <h3>Modes</h3>

                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="modes" id="auto-mode" value="Auto" checked>Auto
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="modes" id="advanced-mode" value="Advanced">Advanced
                        </div>
                        <br><br>
                    </div>

                    <div class="news-sources">
                        <h5 style="display: inline;">News sources</h5>

                        <a class='my-tool-tip' data-toggle="tooltip" data-placement="right" title="Sources are the different media sources that you can receive.">
                            <i class="bi bi-info-circle" style="display: inline;"></i>
                        </a>

                        <div class="form-check">
                            <input class="form-check-input sources" type="checkbox" value="1" name="go" id="go_epfl">
                            <label class="form-check-label" for="go_epfl">
                                GoEPFL
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input sources" type="checkbox" value="2" name="actu" id="ActuEPFL">
                            <label class="form-check-label" for="ActuEPFL">
                                Actu EPFL
                            </label>
                        </div>
                        <br>
                    </div>

                    <div class="time" style="display: none;">
                        <h5 style="display: inline;">Time</h5>
                        <a class='my-tool-tip' data-toggle="tooltip" data-placement="right" title="Time is the time that you want to receive the news.">
                            <i class="bi bi-info-circle" style="display: inline;"></i>
                        </a>
                        <input id="news-time" type="time" name="news-time" value="13:30" style="display: block;">
                        <br><br>
                    </div>



                    <div class="days" style="display: none;">
                        <h5>Days</h5>

                        <div class="form-check">
                            <input class="form-check-input days" type="checkbox" value="" name="monday" id="monday">
                            <label class="form-check-label" for="monday">
                                Monday
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input days" type="checkbox" value="" name="tuesday" id="tuesday">
                            <label class="form-check-label" for="tuesday">
                                Tuesday
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input days" type="checkbox" value="" name="wednesday" id="wednesday">
                            <label class="form-check-label" for="wednesday">
                                Wednesday
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input days" type="checkbox" value="" name="Thursday" id="Thursday">
                            <label class="form-check-label" for="Thursday">
                                Thursday
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input days" type="checkbox" value="" name="friday" id="friday">
                            <label class="form-check-label" for="friday">
                                Friday
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input days" type="checkbox" value="" name="saturday" id="saturday">
                            <label class="form-check-label" for="saturday">
                                Saturday
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input days" type="checkbox" value="" name="sunday" id="sunday">
                            <label class="form-check-label" for="sunday">
                                Sunday
                            </label>
                        </div>
                        <br>
                    </div>

                    <div class="supports">
                        <h5>Supports</h5>

                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="supports" id="splashpage" value="4" checked>SplashPage (Botonews main page)
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="supports" id="telegram" value="1">Telegram
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="supports" id="discord" value="2">Discord
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="supports" id="mail" value="3">Mail
                        </div>
                    </div>
                </div>
                <div class="row gutters">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                        <div class="text-right">
                            <button type="button" id="submit" name="submit"
                                class="btn btn-primary update-button">Create a new subscription</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>

        // Auto mode checked by default on page load / reload
        $(function() {
            var $autoradio = $('input[type=radio][name=modes][value=Auto]');
            $autoradio.prop('checked', true);
        });

        $("a.my-tool-tip").tooltip();

        $(".update-button").click(function () {
            let sources = [];
            var support = $('input[type=radio][name=supports]:checked').attr('value');

            // Fetching all the checked sources and putting them in an array
            $('.sources:checked').each(function () {
                sources.push($(this).attr('value'));
            });

            if($('input[type=radio][name=modes][value=Auto]').prop('checked') == true) {
                axios.post('http://127.0.0.1:8081/subscriptions', {
                userId: "<%= user.userid %>",
                source: sources,
                support: support
                })
                .then(function (response) {
                    if (response.status == 201) {

                    }
                })
            }
            else if($('input[type=radio][name=modes][value=Advanced]').prop('checked') == true) {
                // Subscription type advanced
                let days = [];
                $('.days:checked').each(function () {
                    days.push($(this).attr('name'));
                });
                var time = $('#news-time').val();

                let modalities = {}
                modalities.days = days
                modalities.time = time

                axios.post('http://127.0.0.1:8081/subscriptions', {
                userId: "<%= user.userid %>",
                source: sources,
                support: support,
                modalities: modalities
                })
                .then(function (response) {
                    if (response.status == 201) {

                    }
                })
            }
        });

        // Showing or not showing Advanced mode
        $('input[type=radio][name=modes]').change(function() {
            if (this.value == 'Auto') {
                $('.days').css('display', 'none')
                $('.time').css('display', 'none')
            }
            else if (this.value == 'Advanced') {
                $(".days").removeAttr("style");
                $(".time").removeAttr("style");
            }
        });



    </script>